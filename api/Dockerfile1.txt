# Start with OpenJDK 11 as the base image
FROM openjdk:23-oraclelinux8 as builder

# Set the working directory
WORKDIR /app

# Copy the entire project to the container
COPY . .

# Build the Java Spring project
RUN ./gradlew clean build

# Use the official MySQL 8.0 image as the base image
FROM mysql:8.0

# Set environment variables for MySQL
ENV MYSQL_ROOT_PASSWORD=MountKilimanjaro
ENV MYSQL_DATABASE=rewards

# Copy the MySQL dump file to the container
COPY RewardsDump030224.sql /docker-entrypoint-initdb.d/

# Copy the built JAR file from the builder stage to the MySQL image
COPY --from=builder /app/build/libs/api-0.0.1-SNAPSHOT.jar /app.jar

# Expose the MySQL port
EXPOSE 3306

# CMD instruction to run the Spring Boot application
CMD ["java", "-jar", "/app.jar"]